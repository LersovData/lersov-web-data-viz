var database = require("../database/config");

function listarDados() {
    var instrucao = `
        SELECT D.idDados, D. fluxoDePessoas, D.dtHora 
         FROM dadosSensor as D JOIN sensor as S ON D.fkSensor = S.idSensor ORDER BY idDados DESC LIMIT 7;

    `;
    console.log("Executando a instrução SQL: \n" + instrucao);
    return database.executar(instrucao);
}



function atualizarDados() {
    
    var instrucaoSql = `SELECT 
    fluxoDePessoas,
                    dtHora,
                    DATE_FORMAT(dtHora, '%H:%i:%s')
                FROM dadosSensor
                ORDER BY idDados DESC LIMIT 1`;

console.log("Executando a instrução SQL: \n" + instrucaoSql);
return database.executar(instrucaoSql);
}


function atualizarDadosSetor() {

    var instrucaoSqlSetor = `
        SELECT C.setor, SUM(D.fluxoDePessoas) as totalFluxo
        FROM dadosSensor AS D
        JOIN sensor AS S ON D.fkSensor = S.idSensor
        JOIN corredor AS C ON S.fkCorredor = C.idCorredor
        GROUP BY C.setor;`;

    console.log("Executando a instrução SQL: \n" + instrucaoSqlSetor);
    return database.executarSetor(instrucaoSqlSetor);
}
module.exports = {
    listarDados,
    atualizarDados,
    atualizarDadosSetor
};